<div class="container py-4">
  <div class="card mb-4">
    <div class="card-header">
      <h2>{{ selectedEvent.name }}</h2>
    </div>
    <div class="card-body">
      <div class="row">
        
        <!-- Sección de Detalles del Evento -->
        <div class="col-md-4">
          <div class="event-details">
            <img [src]="selectedEvent.image" [alt]="selectedEvent.band" class="img-fluid rounded mb-3">
            <h3>Banda {{ selectedEvent.band }}</h3>
            <p>{{ selectedEvent.description }}</p>
            <p>Lugar: {{ selectedEvent.location }}</p>
            <p>Fecha: {{ selectedEvent.date }}</p>
            
            <!-- Selección de Localidad y Cantidad de Entradas -->
            <form [formGroup]="bookingForm" class="mt-3">
              <div class="mb-2">
                <label for="locationSelect">Elegir Localidad</label>
                <select id="locationSelect" formControlName="location" class="form-select">
                  <option *ngFor="let option of getLocationOptions()" [value]="option">
                    {{ option }} - {{ getLocationPrice(option) }}
                  </option>
                </select>
              </div>
              <div class="mb-3">
                <label for="quantitySelect">Cantidad de entradas</label>
                <div class="input-group">
                  <button class="btn btn-outline-secondary" (click)="updateQuantity(-1)">-</button>
                  <span class="mx-3">{{ bookingForm.get('quantity')?.value }}</span>
                  <button class="btn btn-outline-secondary" (click)="updateQuantity(1)">+</button>
                </div>
              </div>
              <button class="btn btn-dark w-100 mt-3" (click)="openPaymentModal()">Añadir al Carrito</button>
            </form>
          </div>
        </div>

        <!-- Sección de Distribución de Localidades (Cuadro Central) -->
        <div class="col-md-4">
          <div class="card">
            <div class="card-header">
              <h3>Distribución de localidades</h3>
            </div>
            <div class="card-body text-center">
              <img src="assets/images/seating-chart.png" alt="Distribución de localidades" class="img-fluid mb-3">
              <table class="table table-bordered text-center">
                <thead>
                  <tr>
                    <th>Localidad</th>
                    <th>Disponible</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td>VIP</td>
                    <td>30/200</td>
                  </tr>
                  <tr>
                    <td>Platea</td>
                    <td>80/300</td>
                  </tr>
                  <tr>
                    <td>General</td>
                    <td>150/300</td>
                  </tr>
                </tbody>
              </table>
              <button class="btn btn-dark w-100 mt-3">Ver más Eventos</button>
            </div>
          </div>
        </div>

        <!-- Sección de Carrito de Compras -->
        <div class="col-md-4">
          <form [formGroup]="bookingForm">
            <div class="card">
              <div class="card-header">
                <h3>Carrito de Compras</h3>
              </div>
              <div class="card-body">
                <div class="d-flex justify-content-between">
                  <span>Subtotal:</span>
                  <span>{{ getSubtotal() | currency:'COP' }}</span>
                </div>
                <div *ngIf="discount > 0" class="d-flex justify-content-between text-success">
                  <span>Descuento:</span>
                  <span>-{{ getDiscountAmount() | currency:'COP' }}</span>
                </div>
                <div *ngIf="isFirstPurchase" class="d-flex justify-content-between text-success">
                  <span>Descuento primera compra:</span>
                  <span>-{{ getFirstPurchaseDiscount() | currency:'COP' }}</span>
                </div>
                <div class="d-flex justify-content-between fw-bold">
                  <span>Total:</span>
                  <span>{{ calculateTotal() | currency:'COP' }}</span>
                </div>
                <div class="mt-3 d-flex">
                  <input type="text" formControlName="promoCode" class="form-control me-2" placeholder="Cupón de Descuento">
                  <button class="btn btn-primary" (click)="applyPromoCode()">Aplicar</button>
                </div>
                <button class="btn btn-success w-100 mt-3" (click)="openPaymentModal()">Generar Orden de Compra</button>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal de Pago -->
  <div *ngIf="showPaymentModal" class="modal fade show" tabindex="-1" style="display: block;">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title">Orden de Compra</h5>
          <button type="button" class="btn-close" (click)="closePaymentModal()"></button>
        </div>
        <div class="modal-body">
          <p><strong>Información detallada de tu compra</strong></p>
          <p>{{ selectedEvent.name }} - Fecha del evento: {{ selectedEvent.date }}</p>
          <p>Escoja el Método de pago</p>

          <!-- Iconos de métodos de pago (seleccionables) -->
          <div class="d-flex justify-content-center mb-3">
            <img src="assets/icons/visa.png" alt="Visa" class="img-thumbnail mx-1" 
                 [class.selected]="selectedPaymentMethod === 'Visa'"
                 (click)="selectPaymentMethod('Visa')" style="width: 50px; cursor: pointer;">
            <img src="assets/icons/mastercard.png" alt="MasterCard" class="img-thumbnail mx-1" 
                 [class.selected]="selectedPaymentMethod === 'MasterCard'"
                 (click)="selectPaymentMethod('MasterCard')" style="width: 50px; cursor: pointer;">
            <img src="assets/icons/maestro.png" alt="Maestro" class="img-thumbnail mx-1" 
                 [class.selected]="selectedPaymentMethod === 'Maestro'"
                 (click)="selectPaymentMethod('Maestro')" style="width: 50px; cursor: pointer;">
            <img src="assets/icons/american-express.png" alt="American Express" class="img-thumbnail mx-1" 
                 [class.selected]="selectedPaymentMethod === 'American Express'"
                 (click)="selectPaymentMethod('American Express')" style="width: 50px; cursor: pointer;">
            <img src="assets/icons/paypal.png" alt="PayPal" class="img-thumbnail mx-1" 
                 [class.selected]="selectedPaymentMethod === 'PayPal'"
                 (click)="selectPaymentMethod('PayPal')" style="width: 50px; cursor: pointer;">
          </div>

          <!-- Formulario de tarjeta de crédito -->
          <form [formGroup]="paymentForm" (ngSubmit)="verifyPurchase()">
            <div class="mb-3">
              <label for="cardHolder" class="form-label">Nombre del titular</label>
              <input id="cardHolder" type="text" formControlName="cardHolder" class="form-control" placeholder="Como aparece en la tarjeta">
            </div>
            <div class="mb-3">
              <label for="cardNumber" class="form-label">Número de tarjeta</label>
              <input id="cardNumber" type="text" formControlName="cardNumber" class="form-control" placeholder="Número de tarjeta">
            </div>
            <div class="row mb-3">
              <div class="col">
                <label for="expiryDate" class="form-label">Fecha de expiración</label>
                <input id="expiryDate" type="text" formControlName="expiryDate" class="form-control" placeholder="MM/AA">
              </div>
              <div class="col">
                <label for="cvv" class="form-label">Código de seguridad</label>
                <input id="cvv" type="text" formControlName="cvv" class="form-control" placeholder="3 dígitos">
              </div>
            </div>
            <button type="submit" class="btn btn-primary w-100" [disabled]="!isPaymentFormValid()">Pagar</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
